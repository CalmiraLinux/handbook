# Введение в порты

Порты - относительно молодой (в CalmiraLinux), но, в тоже время, очень удобный инструмент управления ПО. На данный момент, с помощью портов можно только устанавливать и удалять ПО, но в скором времени будут доступны новые функции.

## Введение

Система портов находится в `/usr/ports`. Всё ПО разделено на категории:

* `base` - базовые порты, входящие в минимальную поставку дистрибутива;
* `console` - консольные утилиты;
	* `editors` - консольные текстовые редакторы;
* `kernel` - ядро и его компоненты;
* `multimedia` - мультимедиа утилиты;
* `network` - сетевые утилиты;
	* `browsers` - браузеры и менеджеры скачивания;
	* `connecting` - утилиты для подключения к сети;
* `optional` - дополнительный софт, не вошедший в базовую поставку дистрибутива, но который может понадобиться после установки системы;
	* `libs` - библиотеки;
* `programming` - программирование: языки, доп. компиляторы (не вошедшие в минимальную поставку дистрибутива), модули, предназначенные для разработки библиотеки.
	* `python-modules` - модули для ЯП Python. Часть используются в составе некоторых пакетов;
* `xorg` - сервер X и другое ПО, такое как оконные менеджеры и рабочие окружения;
	* `x11-de` - рабочие окружения для X11;
	* `x11-minimal` - X-сервер и основные утилиты для него;
		* `xlibs` - дополнительные библиотеки Xorg, которые не входят в минимальную поставку Xorg, но которые могут пригодиться при сборке других пакетов (таких как рабочих окружений);
		* `xdrivers` - драйвера Xorg;
	* `x11-wm` - оконные менеджеры Xorg;

В каждой категории несколько подкаталогов с портом программы. Первые версии портов включают в себя только файл `install` с инструкциями по сборке, либо ещё `info` с информацией о пакете. В новых портах вместо `info` используется файл `config.json`, который предназначается ещё и для занесения пакета в базу данных `port-utils`.

## Установка программ из портов

Для того, чтобы установить какую-либо программу из порта, нужно выполнить:

```bash
# Переход в нужную директорию
cd /usr/ports/$КАТЕГОРИЯ/$ПРОГРАММА

# Выполнение инструкций сборки и установки
./install
```

Так же в директории с портом могут находиться следующие файлы:

* `install_doc.sh` - для установки дополнительной документации;
* `setup.html` - инструкции по дальнейшей настройке пакета, которые трудно автоматизировать (нужно активное участие пользователя/администратора для выбора и изменения параметров, например), либо автоматизировать невозможно/не рекомендуется. Пригоден для открытия во всех известных браузерах.
* `setup.sh` (не путать с предыдущим `setup.html`!) - содержит инструкции для автоматизированной настройки пакета после установки для КОНКРЕТНОГО пользователя, от чьего имени запускается этот скрипт. Обычно создаёт нужные директории и конфигурационные файлы в домашней папке (`~/`) того пользователя.
* `info` (устаревший) - содержит описание пакета и его версию. На данный момент заменён на `config.json`, предоставляющий более обширные данные в удобном формате json. Так же используется для добавления пакета в базу данных `port-utils`.

Всё ПО из портов собирается из исходного кода. В некоторых случаях сборка может занять довольно много времени (так, например, пакет `gcc` на очень слабом железе может собираться до трёх дней). Однако, у сборки очень много преимуществ:

1. Возможность оптимизации программы под своё железо;
2. Больший контроль при установке;
3. Выбор нужных функций и удаление ненужных (если программа это поддерживает).

Иногда пакеты предоставляют к установке дополнительную документацию. Она не всем нужна, поэтому мы оставили в портах возможность выбора пользователем: ставить её или нет. Система портов всегда спрашивает пользователя об этом. Если вы отказались от установки такой документации в будущем, но она вам пригодилась позже - перейдите в директорию с портом и выполните:

```bash
chmod +x install_doc.sh
./install_doc.sh
```

Этими командами вы установите документацию пакета.

## Конфигурация порта

Все сведенья и параметры порта находятся в файле `config.json`. Его примерное содержимое здесь:

```json title="config.json"
{
    "name": "имя порта *",
    "version": "версия порта *",
    "description": "описание порта *",
    "maintainer": "сопровождающий порт *",
    "priority": "приоритет порта *",
    "release": "релиз Calmira, для которого предназначен порт",
    "deps": {
        "required": [
            "необходимые зависимости"
        ],
        "runtime": [
            "необходимые зависимотси в рантайме"
        ],
        "optional": [
            "опциональные зависимости"
        ],
        "recommend": [
            "рекомендуемые зависимости"
        ],
        "before": [
            "порт должен быть установлен перед этими зависимостями"
        ],
        "conflict": [
            "конфликтующие с этим портом зависимости"
        ]
    },
    "bins": [
    	"список установленных программ (бинарных файлов) в /bin, /sbin, /usr{,/local}/bin, /usr{,/local}/sbin"
    ],
    "libs": [
    	"список установленных библиотек"
    ],
    "dirs": [
    	"список установленных директорий"
    ]
}
```

Все значения, указанные знаком `*` являются обязательными. Остальные вы используете по мере необходимости.

Подробное объяснение параметров в таблице ниже.

| Параметр | Объяснение | Приоритет |
|----------|------------|-----------|
| `name` | Имя пакета. Важно не путать имена пакета и порта. Например, имя пакета - `vim`, а имя порта - `/base/editors/vim` | Необходимый |
| `version` | Версия пакета | Необходимый |
| `description` | Описание пакета (для чего он предназначен). Только на английском или русском языках. | Необходимый |
| `maintainer` | Имя/псевдоним, а так же почта сопровождающего порта | Необходимый |
| `priority` | Приоритет порта - пользовательский или системный | Необходимый |
| `release` | Порт подготовлен только для определённого релиза дистрибутива CalmiraLinux, на других работа будет некорректной. Номер релиза системы берётся из параметра `DISTRIB_RELEASE` файла `/etc/lsb-release`. | Опциональный |
| `deps` | В этой секции описываются зависимости порта (см. пункт "Зависимости поля `deps`") | Опциональный |
| `bins` | Установленные программы в `/{bin,sbin}` и `/usr/{bin,sbin}` | Опциональный |
| `libs` | Установленные библиотеки | Опциональный |
| `dirs` | Установленные директории | Опциональный |

!!! note "Обратите внимание"
	Если у параметра установлен необходимый приоритет, то этот параметр **обязательно** должен присутствовать в `config.json`. Опциональные параметры выбираются, если сопровождающий считает нужным, а так же по мере наличия нужной информации для заполнения значений этих параметров.

### Зависимости поля `deps`

Примерное содержимое поля `deps`:

```json title="Фрагмент config.json: содержимое поля 'deps'"
"deps": {
    "required": [
        "необходимые зависимости"
    ],
    "runtime": [
        "необходимые зависимотси в рантайме"
    ],
    "optional": [
        "опциональные зависимости"
    ],
    "recommend": [
        "рекомендуемые зависимости"
    ],
    "before": [
       "порт должен быть установлен перед этими зависимостями"
    ],
    "conflict": [
        "конфликтующие с этим портом зависимости"
    ]
},
```

**Параметры:**

| Параметр | Объяснение |
|----------|------------|
| `required` | Необходимые зависимости, без которых порт не может быть собран и установлен. Перед сборкой данного порта, соберите его необходимые зависимости из этого параметра. |
| `runtime` | Необходимые зависимости во время работы компонентов пакета |
| `optional` | Опциональные зависимости. Не обязательны к сборке и установке. Обычно расширяют функционал искомого порта. |
| `recommend` | Рекомендуемые зависимости. Так же не обязательны к сборке и установке, но без них пакет порта может работать нестабильно/некорректно, либо не будут доступны определённые функции и возможности |
| `before` | Необязательные зависимости. Тоже самое, что `optional` и `recommend`, но разница в том, что опциональные и рекомендуемые зависимости могут быть установлены после сборки искомого порта, а `before` - либо установлены **до** искомого порта, либо не установлены вообще. |
| `conflict` | Эти порты конфликтуют с искомым. Возможно они/искомый порт затирают файлы друг друга, либо вызывают всевозможные несовместимости и регрессии. Настоятельно советуется удалить те порты, которые установлены в системе и перечислены в этой секции во избежание ошибок |