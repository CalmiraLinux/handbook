# Создание порта

От помощи в создании порта для сборки какого-либо пакета мы никогда не откажемся. Если есть какие-либо заинтересованные в помощи люди - вы нам нужны.

## Начальный этап

Создайте у себя на GitHub форк [этого](https://github.com/CalmiraLinux/Ports) репозитория, после чего приступайте к работе. Советуем вам клонировать этот репозиторий себе на ПК для удобной работы:

```bash
git clone https://github.com/USERNAME/Ports
cd Ports
```

Замените `USERNAME` на имя пользователя GitHub.

После этих действий вы можете приступать к созданию порта. Хотим обратить ваше внимание на то, что строение порта должно повторять строение других портов.

## Структура системы портов

Просим вас соблюдать структуру системы портов:

```title="Древовидная структура системы портов"
КАТЕГОРИЯ              <название категории брать из Введения в порты>
├── makeport.sh        <скрипт для автоматизации создания порта>
└── ИМЯ_ПАКЕТА         <указывается как аргумент скрипту makeport.sh>
    ├── install        <обязательно>
    ├── install_doc.sh <опционально>
    ├── setup.html     <опционально>
    ├── setup.sh       <опционально>
    └── config.json    <обязательно>
```



Здесь приведена общая структура системы портов. КАТЕГОРИЯ и ИМЯ_ПАКЕТА - директории. КАТЕГОРИЯ - имя категории, в которую входит пакет с именем ИМЯ_ПАКЕТА.

Файл `makeport.sh` нужен для автоматизации создания порта. Он создаёт директорию с именем порта, а так же файл install и откывает его в вашем текстовом редакторе, установленном по умолчанию. Наличие этого файла (`makeport.sh`) необязательно. Синтаксис:

```bash
./makeport.sh $ИМЯ_ПАКЕТА
```

Файл `install` необходим. Он содержит инструкции по сборке ПО из исходного кода. Файл `install_doc.sh` опционален. Если у пакета есть дополнительная документация, которая не устанавливается по умолчанию, то в файле `install_doc.sh` содержатся инструкции по установке документации. Запускать его или нет - зависит от выбора пользователя. Он выбирает нужный ответ в диалоговом окне.

Файл `config.json` содержит информацию о пакете. Она может быть добавлена в базу данных port-utils для удобного управления пакетом. Наличие этого файла ОБЯЗАТЕЛЬНО, так же как и файла `install`.

`setup.html` содержит дополнительные инструкции о дальнейшей настройке пакета после установки. Описаны команды и примеры файлов. Открывается в любом браузере. Файл `setup.sh` предназначен для автоматизированной настройки порта после установки. Как правило, настройка производится только для того пользователя, от имени которого был запущен этот скрипт.

!!! tip "Смотрите также"
    Для установки какого-либо текстового редактора по умолчанию (в TTY) экспортируйте переменную `EDITOR`, значение которой - путь до исполняемого бинарного файла редактора.

## Создание нужных файлов

Перейдите в одну из нужных директорий, выполните:

```bash
./makeport.sh $PACKAGE_NAME
```

Замените `$PACKAGE_NAME` на имя порта. Скрипт `makeport.sh` создаёт нужную директорию и записывает в файл нужную информацию, которая должна содержаться в файле порта.

Если вы не нашли этот скрипт, скопируйте его из любой другой директории.

Будет создан файл `install` в директории, имеющей имя порта, который вы хотите создать. Этот файл будет открыт для редактирования в вашем текстовом редакторе, установленном по умолчанию. Замените строки:

```bash title="Фрагмент install"
# Port created by Linuxoid85
#
# (C) 2021 Michail [Linuxoid85] Krasnov 
```

На строки с вашим именем.

Строки:
```bash title="Фрагмент install"
wget 
tar -xf 
cd 
```

Предназначены для того, чтобы подставить в их конец нужную информацию. `wget` скачивает архив с исходным кодом, `tar -xf` распаковывает его, а `cd` переходит в распакованную директорию.

Запишите в конец файла нужные инструкции для сборки. Доступны все команды bash.

После того, как вы сорханите изменения и выйдите из окна текстового редактора, будет открыт файл `config.json` - в него запишите в него информацию о пакете. Примерное содержимое файла:

```json title="config.json"
{
    "name": "имя порта *",
    "version": "версия порта *",
    "description": "описание порта *",
    "maintainer": "сопровождающий порт *",
    "priority": "приоритет порта *",
    "release": "релиз Calmira, для которого предназначен порт",
    "deps": {
        "required": [
            "необходимые зависимости"
        ],
        "runtime": [
            "необходимые зависимотси в рантайме"
        ],
        "optional": [
            "опциональные зависимости"
        ],
        "recommend": [
            "рекомендуемые зависимости"
        ],
        "before": [
            "порт должен быть установлен перед этими зависимостями"
        ],
        "conflict": [
            "конфликтующие с этим портом зависимости"
        ]
    },
    "bins": [
    	"список установленных программ (бинарных файлов) в /bin, /sbin, /usr{,/local}/bin, /usr{,/local}/sbin"
    ],
    "libs": [
    	"список установленных библиотек"
    ],
    "dirs": [
    	"список установленных директорий"
    ]
}
```

Все значения, указанные знаком `*` являются обязательными. Остальные вы используете по мере необходимости.

Так же можете написать bash-скрипт `setup.sh` для автоматизированной настройки порта (как правило, для создания основных конфигов и директорий) после установки. Эта настройка производится для конкретного пользователя, от чьего имени был запущен скрипт.

Если у пакета есть дополнительные настройки, которые трудно автоматизировать (нужно активное участие пользователя/администратора для выбора и изменения параметров, например), либо автоматизировать невозможно/не рекомендуется, то поместите рекомендации по настройке в файл `setup.html`. Формат такого файла должен быть примерно таким:

```html title="setup.html"
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
	<title>Configuring $PACKAGE_NAME</title>
</head>
<link rel="stylesheet" href="/usr/share/update-ports/css/styles.css">
<body style="margin: 0px 150px 0px 150px">

<h1>Configuring $PACKAGE_NAME</h1><hr>

<h2>Заголовок второго уровня</h2>

<p>Абзац</p>

<table border="1" width="100%" cellpadding="5"><colgroup>
	<col style="background-color:#eeddcc">
</colgroup>
<tr><td>
<pre>
Команда, которую нужно ввести в терминал, либо же пример кода
</pre></td></tr></table>

<table border="1" width="100%" cellpadding="5">
<tr><td>
<pre>
Пример текстового файла, либо вывода команды в терминал
</pre></td></tr></table>

</body></html>
```

## Отправка изменений на GitHub

Если вы клонировали репозиторий себе на ПК, выполните:

```bash
# Фиксирование изменений
git add .
git commit -m "Добавление порта с пакетом $PACKAGE_NAME"

# Отправка изменений себе на GitLab
git push
```

Замените `$PACKAGE_NAME` на имя порта с пакетом.

Если вы делали всё в Web, то отметьте изменения с помощью графического интерфейса GitHub.

Создайте запрос на слияние (pull-request). Создание порта завершено!

## Ports API

:octicons-heart-fill-24: TODO :octicons-zap-24: Future

В будущем планируется создать единый Ports API, позволяющий разработчикам более быстро создавать свои порты. Этот API позволит им без проблем вызывать всевозможные диалоги, работать с БД системы портов и пр.