# Настройка сети

По умолчанию в Calmira GNU/Linux-libre содержится небольшое число программного
обеспечения для работы сети:

- inetutils;
- dhcpcd;
- wpa_supplicant;
- wget;
- links;
- make-ca.

Кроме того, в ядре присутствует поддержка лишь некоторых моделей сетевых карт.
Если ваша сетевая карта не поддерживается, вы можете пересобрать ядро с её
поддержкой.

## Определение имён сетевых интерфейсов

### `ifconfig`

Если работа сети коректна, и ваше оборудование поддерживается, в выводе
программы `ifconfig` должен присутствовать один или несколько сетевых
интерфейсов (кроме `lo`). В примере ниже показан `wlp2s0`:

```
root:# ifconfig
wlp2s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.17.147  netmask 255.255.255.0  broadcast 192.168.17.255
        RX packets 115606  bytes 148678208 (141.7 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 65005  bytes 7442031 (7.0 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

!!! note "Совет"
    Если в выводе `ifconfig` нет нужных вам интерфейсов, попробуйте использовать
    ту же команду с ключом `-a`. Если это не даёт никаких результатов, то либо
    ваше оборудование неисправно, либо в ядре нет драйвера для конкретной
    сетевой карты. В последнем случае вам придётся пересобрать ядро с
    добавлением в его конфиг опции для сборки нужного вам драйвера.

### `ip`

Заместо `ifconfig` для определения сетевых интерфейсов можно использовать `ip`.
В следующем примере показан вывод `ip addr`:

```
root:# ip addr
3: wlp2s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 50:b7:c3:17:61:51 brd ff:ff:ff:ff:ff:ff
    inet 192.168.17.147/24 brd 192.168.17.255 scope global dynamic noprefixroute wlp2s0
       valid_lft 3319sec preferred_lft 3319sec
    inet6 fe80::d212:4020:3354:8a77/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
```

Вывод команды может быть слегка сложнее для восприятия.

## Проверка сети

Проверьте DNS-сервер своего провайдера (адрес можно найти в файле
`/etc/resolv.conf`) и любой интернет сайт.

```
root:# ping -c 3 www.google.com
```

## Ручная конфигурация сети

### DHCP

DHCP (Dynamic Host Configuration Protocol) позволяет автоматически получать
данные о сети (IP-адрес, маску подсети, шлюз и прочее). Данный сценарий
возможен в случае, если в сети присутствует DHCP-сервер. Чтобы сетевой интерфейс
получал эти сведения автоматически, используйте `dhcpcd`:

```
root:# dhcpcd wlp2s0
```

## Необходимые файлы

Какие интерфейсы запускаются и отключаются сетевым скриптом, обычно зависит от
файлов в `/etc/syscinfig`. Эта директория должна содержать файл для каждого
настраиваемого интерфейса, например, `ifconfig.XXX`, где `XXX` должно
описывать сетевую карту. Имя интерфейса (например, `wlp2s0`) обычно является
подходящим. Внутри этого файла находятся атрибуты этого интерфейса, такие как
его IP-адреса, маски подсети и так далее. Необходимо, чтобы основа имени
была `ifconfig`.

Следующая команда создаст примерный файо для устройства `wlp2s0` со
статическим IP-адресом:

```bash
cd /etc/sysconfig/
cat > ifconfig.wlp2s0 << "EOF"
ONBOOT=yes
IFACE=wlp2s0
SERVICE=ipv4-static
IP=192.168.1.2
GATEWAY=192.168.1.1
PREFIX=24
BROADCAST=192.168.1.255
EOF
```

Значения указанных переменных должны быть изменены в каждом файле, чтобы
соответствовать правильной настройке.

Если для переменной `ONBOOT` установлено значение `yes`, сетевой сценарий
System V вызовет Network Interface Card (NIC) во время процесса загрузки
системы. Если установлено значение, отличное от `yes`, сетевой адаптер будет
проигнорирован сетевым скриптом и не будет автоматически вызван. Интерфейс
можно запустить или остановить вручную с помощью `ifup` и `ifdown`.

Переменная `IFACE` определяет имя интерфейса, например, `wlp2s0`. Он необходим
для всех файлов конфигурации сетевого устройства. Расширение имени файла
должно соответствовать этому значению.

Переменная `SERVICE` определяет метод, используемый для получения IP-адреса.
Порт `base/bootscripts` имеет модульный формат назначения IP, а создание
дополнительных файлов в директории `/lib/services` позволяет использовать
другие методы назначения IP. Это обычно используется для протокола
динамической настройки хоста (DHCP).

`GATEWAY` должна содержать IP-адрес шлюза по умолчаниб, если таковой имеется.
Если нет, то закомментируйте переменную.

`PREFIX` содержит кол-во битов, используемых в подсети. Каждый октет в
IP-адресе равен 8 битам. Если маска сети подсети равна 255.255.255.0, то для
укащания номера сети используются первые 3 октета (24 бита). Если сетевая
маска равна 255.255.255.240, она будет использовать первые 28 битов. Префиксы
длиной более 24 бит обычно используются поставщиками услуг DSL и кабельного
интернета (ISP). В примере конфига выше маска сети равна 255.255.255.0. Если
этот параметр отсутствует, `PREFIX` по умолчанию равен 24.

!!! note "Смотрите также"
    `man ifup`
